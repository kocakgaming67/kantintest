<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kantin Sekolah</title>

  <style>
  body {
    margin: 0; padding: 0; font-family: "Poppins", sans-serif; color: #fff;
    background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    background-size: 300% 300%;
    animation: gradientMove 15s ease infinite;
  }
  @keyframes gradientMove {
    0%{background-position:0% 50%;}
    50%{background-position:100% 50%;}
    100%{background-position:0% 50%;}
  }

  h1{text-align:center;margin-bottom:15px;font-size:28px;color:#7dd3fc;}
  .container{max-width:1200px;margin:0 auto;padding:20px;}

  .top-left{position:fixed;top:15px;left:15px;display:flex;align-items:center;gap:10px;z-index:1001;}
  .hamburger{font-size:26px;cursor:pointer;background:rgba(255,255,255,0.1);padding:8px 12px;
    border-radius:8px;backdrop-filter:blur(10px);transition:all .2s;}
  .hamburger:hover{background:rgba(0,255,255,0.2);}
  .logo{width:40px;cursor:pointer;animation:float 3s ease-in-out infinite;}
  @keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-6px);}}

  .sidebar{position:fixed;top:0;left:-260px;width:250px;height:100%;
    background:rgba(255,255,255,0.05);backdrop-filter:blur(15px);
    border-right:1px solid rgba(255,255,255,0.2);box-shadow:0 0 20px rgba(0,0,0,0.3);
    transition:left .3s ease;padding-top:60px;z-index:1000;}
  .sidebar.show{left:0;}
  .sidebar a{display:block;padding:15px 20px;text-decoration:none;color:#fff;transition:background .2s;}
  .sidebar a:hover{background:rgba(0,255,255,0.15);}

  .filter-bar{text-align:center;margin-bottom:15px;}
  .filter-bar button{margin:0 6px;padding:8px 20px;border:none;border-radius:20px;cursor:pointer;
    font-weight:500;background:rgba(255,255,255,0.08);color:#fff;
    backdrop-filter:blur(8px);transition:all .3s ease,transform .2s ease;
    box-shadow:inset 0 0 5px rgba(0,255,255,0.2);}
  .filter-bar button:hover{background:rgba(0,255,255,0.2);box-shadow:0 0 15px #00e5ff;transform:scale(1.1);}
  .filter-bar button.active{background:rgba(0,255,255,0.25);box-shadow:0 0 20px #00e5ff;}

  .search-container{display:flex;justify-content:center;margin-bottom:15px;}
  #searchBox{width:100%;max-width:400px;padding:10px 15px;border-radius:20px;border:none;outline:none;
    background:rgba(255,255,255,0.08);color:#fff;font-size:15px;text-align:center;
    backdrop-filter:blur(8px);transition:all .3s ease;}
  #searchBox::placeholder{color:rgba(255,255,255,0.6);}
  #searchBox:focus{box-shadow:0 0 12px #00e5ff;background:rgba(255,255,255,0.12);transform:scale(1.02);}

  #menu{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px;margin-top:20px;}
  .menu-item{background:rgba(255,255,255,0.05);border-radius:15px;padding:15px;
    display:flex;flex-direction:column;align-items:center;text-align:center;
    border:1px solid rgba(255,255,255,0.15);backdrop-filter:blur(12px);
    box-shadow:0 0 20px rgba(0,255,255,0.05);transition:all .3s ease;}
  .menu-item:hover{transform:translateY(-5px);box-shadow:0 0 25px rgba(0,255,255,0.3);}
  .menu-img{width:100px;height:100px;border-radius:12px;object-fit:cover;margin-bottom:10px;}

  .variant-select{
    margin-top:8px;background:rgba(255,255,255,0.08);
    border:1px solid rgba(0,255,255,0.3);color:#7dd3fc;border-radius:12px;
    padding:6px 10px;backdrop-filter:blur(10px);
    box-shadow:0 0 10px rgba(0,255,255,0.2);cursor:pointer;transition:all .3s ease;
  }
  .variant-select:hover{background:rgba(0,255,255,0.15);box-shadow:0 0 15px rgba(0,255,255,0.4);}

  /* Expandable menu container */
  #menuContainer {
    overflow: hidden;
    max-height: 0;
    opacity: 0;
    transition: max-height 0.6s ease, opacity 0.4s ease;
  }
  #menuContainer.show {
    max-height: none;
    opacity: 1;
  }

  .toggle-menu-btn{
    display:block;
    margin:0 auto 15px auto;
    padding:10px 25px;
    border:none;
    border-radius:20px;
    font-size:16px;
    cursor:pointer;
    color:#fff;
    background:rgba(0,255,255,0.15);
    box-shadow:0 0 12px rgba(0,255,255,0.3);
    transition:all 0.3s ease;
  }
  .toggle-menu-btn:hover{
    background:rgba(0,255,255,0.25);
    box-shadow:0 0 20px rgba(0,255,255,0.4);
  }

  .counter{display:flex;align-items:center;gap:8px;margin-top:10px;}
  .counter button{width:36px;height:36px;display:flex;justify-content:center;align-items:center;
    border:none;border-radius:50%;background:rgba(0,255,255,0.15);color:#00e5ff;font-size:18px;
    font-weight:bold;cursor:pointer;transition:all .3s ease;
    box-shadow:inset 0 0 8px rgba(0,229,255,0.3),0 0 10px rgba(0,229,255,0.15);}
  .counter button:hover:not(:disabled){background:rgba(0,255,255,0.25);box-shadow:0 0 15px #00e5ff;transform:scale(1.15);}
  .counter button:disabled{background:rgba(100,100,100,0.4);color:#aaa;cursor:not-allowed;box-shadow:none;}
  .counter span{min-width:20px;text-align:center;font-size:16px;font-weight:bold;}
  #cart-summary{
    margin-top:30px;
    background:rgba(255,255,255,0.05);
    padding:20px;
    border-radius:15px;
    border:1px solid rgba(255,255,255,0.2);
    backdrop-filter:blur(15px);
    box-shadow:0 0 25px rgba(0,0,0,0.3);
    color:#fff;
  }
  #cart-summary h2{text-align:center;font-size:22px;margin-bottom:20px;color:#7dd3fc;}
  #cart-summary table{width:100%;border-collapse:collapse;margin-bottom:15px;}
  #cart-summary th,#cart-summary td{padding:8px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.2);}

  .checkout-btn{
    background:linear-gradient(135deg,#43e97b,#38f9d7);
    border:none;padding:12px 25px;border-radius:30px;
    color:#fff;cursor:pointer;font-size:16px;font-weight:bold;
    transition:all .3s ease;box-shadow:0 0 15px rgba(72,239,128,0.4);
  }
  .checkout-btn:hover{transform:scale(1.05);box-shadow:0 0 25px #4effb8;}

  .order-status{margin-top:15px;padding:10px;border-radius:10px;font-weight:bold;text-align:center;}
  .pending{background:rgba(255,193,7,0.15);color:#ffda6a;border:1px solid #ffda6a;}
  .selesai{background:rgba(40,167,69,0.15);color:#6fdd8c;border:1px solid #6fdd8c;}

  /* Ensure counter buttons always visible */
  .counter button {
    color: #00e5ff !important;
    background: rgba(0, 255, 255, 0.15) !important;
    box-shadow: inset 0 0 8px rgba(0, 229, 255, 0.3), 0 0 10px rgba(0,229,255,0.15);
  }
  </style>
</head>

<body>
  <div class="top-left">
    <div class="hamburger" onclick="toggleSidebar()">‚ò∞</div>
    <img src="logo.png" class="logo" alt="Logo Sekolah" onclick="window.location.href='dashboard.html'">
  </div>

  <div class="sidebar" id="sidebar">
    <a href="dashboard.html">üè† Dashboard</a>
    <a href="index.html" class="active">üìã Order</a>
    <a href="riwayat.html">üìú Riwayat</a>
    <a href="antrian.html">üïí Antrian</a>
  </div>

  <div class="container">
    <div id="orderPage" class="page active">
      <h1> </h1>

      <div class="filter-bar">
        <button class="active" onclick="filterCategory('all', event)">Semua</button>
        <button onclick="filterCategory('snack', event)">Snack</button>
        <button onclick="filterCategory('minuman', event)">Minuman</button>
        <button onclick="filterCategory('roti', event)">Roti</button>
      </div>

      <div class="search-container">
        <input type="text" id="searchBox" placeholder="Cari menu...">
      </div>

      <!-- Expandable menu toggle -->
      <button class="toggle-menu-btn" onclick="toggleMenu()">Tampilkan Menu</button>

      <div id="menuContainer">
        <div id="menu"></div>

        <!-- Cart section -->
        <div id="cart-summary">
          <h2>üõí Keranjang</h2>
          <table id="orderTable">
            <thead>
              <tr>
                <th>Menu</th>
                <th>Jumlah</th>
                <th>Harga</th>
                <th>Subtotal</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <p>Total Item: <span id="totalItems">0</span></p>
          <p>Total Harga: Rp<span id="totalPrice">0</span></p>

          <div class="center">
            <button class="checkout-btn" onclick="checkout()">Pesan</button>
          </div>
          <div id="last-order-status"></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    function toggleSidebar() {
      document.getElementById("sidebar").classList.toggle("show");
    }

    // Toggle show/hide menu with animation
    function toggleMenu() {
      const container = document.getElementById("menuContainer");
      const btn = document.querySelector(".toggle-menu-btn");
      container.classList.toggle("show");
      btn.textContent = container.classList.contains("show")
        ? "Sembunyikan Menu"
        : "Tampilkan Menu";
    }

    // ======== MENU DATA ========
    const menu = [
      { nama:"Bakwan", harga:1000, gambar:"bakwan.jpg", deskripsi:"per pcs", kategori:"snack", stok:10 },
      { nama:"Dayaki", harga:1000, gambar:"dayaki.jpg", deskripsi:"per bungkus", kategori:"snack", stok:8 },
      { nama:"Donat", harga:1000, gambar:"donat.jpg", deskripsi:"per pcs", kategori:"roti", stok:12 },
      { nama:"Pop Mie", harga:7000, gambar:"popmie.jpg", deskripsi:"per cup", kategori:"snack", stok:5 },

      { nama:"Roti Beta", deskripsi:"per bungkus", kategori:"roti", stok:10,
        variants:[
          { nama:"Moka", harga:1000, gambar:"rotibeta_moka.jpg" },
          { nama:"Cream", harga:1000, gambar:"rotibeta_cream.jpg" },
          { nama:"Kompiang", harga:1000, gambar:"rotibeta_kompiang.jpg" },
          { nama:"Kacang Hijau", harga:1000, gambar:"rotibeta_kacanghijau.jpg" }
        ]
      },

      { nama:"Pukis", harga:1000, gambar:"pukis.jpg", deskripsi:"per pcs", kategori:"roti", stok:10 },
      { nama:"Klepon", harga:2000, gambar:"klepon.jpg", deskripsi:"per bungkus", kategori:"snack", stok:10 },
      { nama:"Nabati", harga:2000, gambar:"nabati.jpg", deskripsi:"per bungkus", kategori:"snack", stok:10 },
      { nama:"Wafello", harga:2000, gambar:"wafello.jpg", deskripsi:"per bungkus", kategori:"snack", stok:10 },
      { nama:"Pia Bali", harga:1000, gambar:"piabali.jpg", deskripsi:"per pcs", kategori:"snack", stok:10 },
      { nama:"Lemonilo", harga:1000, gambar:"lemonilo.jpg", deskripsi:"per bungkus", kategori:"snack", stok:10 },
      { nama:"Better", harga:1000, gambar:"better.jpg", deskripsi:"per bungkus", kategori:"snack", stok:10 },

      { nama:"Kacang", deskripsi:"per bungkus", kategori:"snack", stok:10,
        variants:[
          { nama:"Garuda", harga:1000, gambar:"garuda_original.jpg" },
          { nama:"Atom", harga:1000, gambar:"garuda_atom.jpg" }
        ]
      },

      { nama:"Malkis", harga:1000, gambar:"malkis.jpg", deskripsi:"per bungkus", kategori:"snack", stok:10 },
      { nama:"Gery Salut", harga:1000, gambar:"gerysalut.jpg", deskripsi:"per bungkus", kategori:"snack", stok:10 },
      { nama:"Tic Tac", harga:1000, gambar:"tiktak.jpg", deskripsi:"per bungkus", kategori:"snack", stok:10 },

      { nama:"Permen", deskripsi:"per bungkus", kategori:"snack", stok:10,
        variants:[
          { nama:"Kaki", harga:1000, gambar:"permen_kaki.jpg" },
          { nama:"Mexiko", harga:1000, gambar:"permen_mexiko.jpg" },
          { nama:"Kopiko", harga:1000, gambar:"kopiko.jpg" },
          { nama:"Karet", harga:1000, gambar:"permenkaret.jpg" },
          { nama:"Pendekar Biru", harga:1000, gambar:"pendekarbiru.jpg" },
          { nama:"Mentos", harga:1000, gambar:"mentos.jpg" }
        ]
      },

      { nama:"Golda Coffee", harga:5000, gambar:"golda.jpg", deskripsi:"per botol", kategori:"minuman", stok:10 },
      { nama:"Floridina", harga:5000, gambar:"floridina.jpg", deskripsi:"per botol", kategori:"minuman", stok:10 },
      { nama:"Milku", harga:5000, gambar:"milku.jpg", deskripsi:"per botol", kategori:"minuman", stok:10 },
      { nama:"Vita Jelly", harga:1000, gambar:"vitajelly.jpg", deskripsi:"per cup", kategori:"minuman", stok:10 },
      { nama:"Ale Ale", harga:1000, gambar:"aleale.jpg", deskripsi:"per pouch", kategori:"minuman", stok:10 },
      { nama:"Teh Pucuk", harga:5000, gambar:"tehpucuk.jpg", deskripsi:"per botol", kategori:"minuman", stok:10 },
      { nama:"Teh Rio", harga:1000, gambar:"tehrio.jpg", deskripsi:"per pouch", kategori:"minuman", stok:10 },
      { nama:"Air Putih", harga:1000, gambar:"airputih.jpg", deskripsi:"per cup", kategori:"minuman", stok:10 }
    ];

    const selectedVariantIndex = {};
    let cart = [];
    let currentCategory = "all";

    function renderMenu(filter = "", category = currentCategory) {
      const menuDiv = document.getElementById("menu");
      menuDiv.innerHTML = "";
      menu
        .filter(item => item.nama.toLowerCase().includes(filter.toLowerCase()))
        .filter(item => category === "all" || item.kategori === category)
        .forEach((item, index) => {
          const vIdx = item.variants ? (selectedVariantIndex[index] ?? 0) : null;
          const currentVariant = item.variants ? item.variants[vIdx] : null;
          const displayHarga = item.variants ? currentVariant.harga : item.harga;
          const displayGambar = item.variants ? currentVariant.gambar : item.gambar;
          const labelName = item.variants ? `${item.nama} (${currentVariant.nama})` : item.nama;
          const cartItem = cart.find(c => c.key === buildCartKey(index, vIdx));
          const jumlah = cartItem ? cartItem.jumlah : 0;
          const disabled = item.stok <= 0 ? "disabled" : "";
          const div = document.createElement("div");
          div.className = "menu-item";
          const variantHTML = item.variants ? `
            <select class="variant-select" onchange="changeVariant(${index}, this.value)">
              ${item.variants.map((v,i)=>`<option value="${i}" ${i===vIdx?'selected':''}>${v.nama} - Rp${v.harga}</option>`).join("")}
            </select>` : "";
          div.innerHTML = `
            <img id="img-${index}" src="${displayGambar}" alt="${labelName}" class="menu-img">
            <span id="name-${index}"><b>${labelName}</b> - Rp${displayHarga.toLocaleString()}</span>
            ${variantHTML}
            <small style="opacity:0.8;font-size:13px;">${item.deskripsi}</small><br>
            <small>Stok: ${item.stok}</small>
            <div class="counter">
              <button onclick="updateCart(${index}, -1)">‚àí</button>
              <span>${jumlah}</span>
              <button onclick="updateCart(${index}, 1)" ${disabled}>+</button>
            </div>`;
          menuDiv.appendChild(div);
        });
    }

    function filterCategory(cat,e){
      currentCategory=cat;
      renderMenu(document.getElementById("searchBox").value,cat);
      document.querySelectorAll(".filter-bar button").forEach(b=>b.classList.remove("active"));
      e.target.classList.add("active");
    }

    function buildCartKey(index,vIdx){return menu[index].variants?`${index}:${vIdx??(selectedVariantIndex[index]??0)}`:`${index}`;}

    function changeVariant(index,variantIndex){
      selectedVariantIndex[index]=parseInt(variantIndex,10);
      const item=menu[index];const v=item.variants[selectedVariantIndex[index]];
      document.getElementById(`img-${index}`).src=v.gambar;
      document.getElementById(`name-${index}`).innerHTML=`<b>${item.nama} (${v.nama})</b> - Rp${v.harga.toLocaleString()}`;
      renderMenu(document.getElementById("searchBox").value);
      updateSummary();
    }

    function updateCart(index,delta){
      const item=menu[index];
      const hasVar=!!item.variants;
      const vIdx=hasVar?(selectedVariantIndex[index]??0):null;
      const v=hasVar?item.variants[vIdx]:null;
      const cartKey=buildCartKey(index,vIdx);
      const label=hasVar?`${item.nama} (${v.nama})`:item.nama;
      const price=hasVar?v.harga:item.harga;
      const img=hasVar?v.gambar:item.gambar;
      const cartItem=cart.find(c=>c.key===cartKey);
      if(delta>0&&item.stok<=0){alert(item.nama+" habis!");return;}
      if(cartItem){cartItem.jumlah+=delta;if(cartItem.jumlah<=0)cart=cart.filter(c=>c.key!==cartKey);}
      else if(delta>0){cart.push({key:cartKey,menu:label,harga:price,jumlah:1,gambar:img});}
      renderMenu(document.getElementById("searchBox").value);updateSummary();
    }

    function updateSummary(){
      const tbody=document.querySelector("#orderTable tbody");
      tbody.innerHTML="";
      let totalItems=0,totalPrice=0;
      cart.forEach(i=>{
        const sub=i.jumlah*i.harga;
        totalItems+=i.jumlah;totalPrice+=sub;
        const row=document.createElement("tr");
        row.innerHTML=`<td>${i.menu}</td><td>${i.jumlah}</td><td>Rp${i.harga.toLocaleString()}</td><td>Rp${sub.toLocaleString()}</td>`;
        tbody.appendChild(row);
      });
      document.getElementById("totalItems").textContent=totalItems;
      document.getElementById("totalPrice").textContent=totalPrice.toLocaleString();
    }

    async function sendToDiscord(order){
      const webhookURL="https://discord.com/api/webhooks/1425401447608094720/3edFAYa9mnY3pllGJKl9OwFdNTkBXh-jPGCjebk52BQCsP7FT2b40fGItbp4sO_CS_K4";
      const total=order.pesanan.reduce((a,i)=>a+i.harga*i.jumlah,0);
      const list=order.pesanan.map(i=>`‚Ä¢ ${i.jumlah}√ó ${i.menu} Rp${(i.harga*i.jumlah).toLocaleString()}`).join("\n");

      const embed={
        title:"Pesanan Baru Diterima",
        color:0x00d26a,
        fields:[
          {name:"Kelas",value:order.kelas,inline:true},
          {name:"Waktu",value:new Date().toLocaleString("id-ID"),inline:false},
          {name:"Total",value:`Rp${total.toLocaleString()}`,inline:false},
          {name:"Detail Pesanan",value:list||"Tidak ada item.",inline:false}
        ]
      };
      try{
        await fetch(webhookURL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({embeds:[embed]})});
      }catch(e){console.error("Gagal kirim ke Discord",e);}
    }

    async function checkout(){
      if(cart.length===0){alert("Keranjang kosong.");return;}
      const nama=localStorage.getItem("nama")||"Siswa";
      const kelas=localStorage.getItem("kelas")||"-";
      const totalHarga=cart.reduce((a,i)=>a+i.harga*i.jumlah,0);
      let allOrders=JSON.parse(localStorage.getItem("orders")||"[]");
      const newOrder={id:Date.now(),nama,kelas,pesanan:cart,total:totalHarga,status:"pending"};
      allOrders.push(newOrder);
      localStorage.setItem("orders",JSON.stringify(allOrders));
      showLastOrderStatus(newOrder);
      await sendToDiscord(newOrder);
      cart=[];renderMenu(document.getElementById("searchBox").value);updateSummary();
    }

    function showLastOrderStatus(order){
      const div=document.getElementById("last-order-status");
      const c=order.status==="selesai"?"selesai":"pending";
      const t=order.status==="selesai"?"‚úÖ Selesai":"‚è≥ Pending (menunggu diproses)";
      div.innerHTML=`<div class="order-status ${c}">Status pesanan terakhir: ${t}</div>`;
    }

    renderMenu();
    updateSummary();
    document.getElementById("searchBox").addEventListener("input",e=>renderMenu(e.target.value));
  </script>
</body>
</html>
