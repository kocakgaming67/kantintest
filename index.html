<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kantin Sekolah</title>
  <style>
    body {
      margin: 0; padding: 20px; font-family: "Poppins", sans-serif; color: white;
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
      background-size: 300% 300%; animation: gradientMove 10s ease infinite;
    }
    @keyframes gradientMove {
      0% { background-position: 0% 50%; } 
      50% { background-position: 100% 50%; } 
      100% { background-position: 0% 50%; }
    }
    h1 { text-align: center; margin-bottom: 20px; font-size: 34px; text-shadow: 0 4px 10px rgba(0,0,0,0.5); }

    #total-bar {
      position: sticky; top: 0; z-index: 999; background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);
      padding: 10px 20px; border-radius: 12px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;
      font-weight: bold; font-size: 16px;
    }

    .menu-item {
      background: rgba(255,255,255,0.1); border-radius: 15px; padding: 15px; margin: 15px 0;
      display: flex; justify-content: space-between; align-items: center; backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s ease;
    }
    .menu-item:hover { transform: scale(1.02); box-shadow: 0 8px 25px rgba(0,0,0,0.4); }
    .menu-img { width: 70px; height: 70px; border-radius: 12px; object-fit: cover; margin-right: 15px; }

    .counter { display: flex; align-items: center; gap: 8px; }
    .counter button {
      width: 36px; height: 36px; display: flex; justify-content: center; align-items: center;
      background: linear-gradient(135deg, #007bff, #00d4ff); border: none; border-radius: 50%;
      color: white; cursor: pointer; font-size: 18px; font-weight: bold; transition: all 0.3s ease;
    }
    .counter button:hover { background: linear-gradient(135deg, #0056b3, #0099cc); transform: scale(1.1); box-shadow: 0 4px 12px rgba(0,0,0,0.4); }
    .counter span { min-width: 20px; text-align: center; font-size: 16px; font-weight: bold; }

    #cart-summary {
      margin-top: 30px; background: rgba(0,0,0,0.4); padding: 20px; border-radius: 15px;
      backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.2); animation: fadeIn 1s ease;
    }
    @keyframes fadeIn { from{opacity:0; transform:translateY(20px);} to{opacity:1; transform:translateY(0);} }
    #cart-summary h2 { margin-top: 0; text-align: center; font-size: 24px; margin-bottom: 20px; }
    #cart-summary table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
    #cart-summary th, #cart-summary td { padding: 10px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.2); }
    .center { text-align: center; }
    .checkout-btn {
      background: linear-gradient(135deg, #28a745, #6fdd8c); border: none; padding: 12px 25px; border-radius: 30px;
      color: white; cursor: pointer; font-size: 18px; font-weight: bold; transition: all 0.3s ease;
    }
    .checkout-btn:hover { background: linear-gradient(135deg, #1e7e34, #4cb96b); transform: scale(1.05); box-shadow: 0 6px 20px rgba(0,0,0,0.4); }

    #success-popup {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.8);
      background: rgba(0,0,0,0.85); color: white; padding: 30px 40px; border-radius: 15px; text-align: center;
      font-size: 20px; font-weight: bold; opacity: 0; pointer-events: none; transition: all 0.4s ease; z-index: 9999;
    }
    #success-popup.show { opacity: 1; transform: translate(-50%, -50%) scale(1); }

    /* Search box */
    #searchBox {
      width: 100%; padding: 10px; border-radius: 10px; border: none; 
      margin-bottom: 15px; text-align: center; font-size: 15px;
      background: rgba(255,255,255,0.2); color: white;
    }
    #searchBox::placeholder { color: rgba(255,255,255,0.7); }
  </style>
</head>
<body>
  <h1>Kantin Sekolah</h1>

  <div id="total-bar">
    <span>Total Item: <span id="totalItemsTop">0</span></span>
    <span>Total: Rp<span id="totalPriceTop">0</span></span>
  </div>

  <!-- Search menu -->
  <input type="text" id="searchBox" placeholder="Cari menu...">

  <div id="menu"></div>

  <div id="cart-summary">
    <h2>Keranjang</h2>
    <table id="orderTable">
      <thead>
        <tr><th>Menu</th><th>Jumlah</th><th>Harga</th><th>Subtotal</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <p>Total Item: <span id="totalItems">0</span></p>
    <p>Total Harga: Rp<span id="totalPrice">0</span></p>
    <div class="center">
      <button class="checkout-btn" onclick="checkout()">Pesan Sekarang</button>
    </div>
  </div>

  <div id="success-popup">Pesanan berhasil dikirim.</div>

  <script>
    const menu = [
      { nama:"Bakwan", harga:1000, gambar:"bakwan.jpg", deskripsi:"per pcs" },
      { nama:"Dayaki", harga:1000, gambar:"dayaki.jpg", deskripsi:"per bungkus" },
      { nama:"Donat", harga:1000, gambar:"donat.jpg", deskripsi:"per pcs" },
      { nama:"Pop Mie", harga:7000, gambar:"popmie.jpg", deskripsi:"per cup" },
      { nama:"Roti Beta", harga:2000, gambar:"rotibeta.jpg", deskripsi:"per bungkus" }
    ];
    let cart = [];

    function renderMenu(filter = "") {
      const menuDiv = document.getElementById("menu");
      menuDiv.innerHTML = "";
      menu
        .filter(item => item.nama.toLowerCase().includes(filter.toLowerCase()))
        .forEach((item, index) => {
          const div = document.createElement("div");
          div.className = "menu-item";
          const cartItem = cart.find(c => c.menu === item.nama);
          const jumlah = cartItem ? cartItem.jumlah : 0;
          div.innerHTML = `
            <div style="display:flex; align-items:center;">
              <img src="${item.gambar}" alt="${item.nama}" class="menu-img">
              <div>
                <span>${item.nama} - Rp${item.harga.toLocaleString()}</span><br>
                <small style="opacity:0.8; font-size:13px;">${item.deskripsi}</small>
              </div>
            </div>
            <div class="counter">
              <button onclick="updateCart(${index}, -1)">-</button>
              <span>${jumlah}</span>
              <button onclick="updateCart(${index}, 1)">+</button>
            </div>
          `;
          menuDiv.appendChild(div);
        });
    }

    function updateCart(index, delta) {
      const item = menu[index];
      const cartItem = cart.find(c => c.menu === item.nama);
      if (cartItem) {
        cartItem.jumlah += delta;
        if (cartItem.jumlah <= 0) cart = cart.filter(c => c.menu !== item.nama);
      } else if (delta > 0) {
        cart.push({ menu:item.nama, harga:item.harga, jumlah:1 });
      }
      renderMenu(document.getElementById("searchBox").value); updateSummary();
    }

    function updateSummary() {
      const tbody = document.querySelector("#orderTable tbody");
      tbody.innerHTML = "";
      let totalItems = 0, totalPrice = 0;

      cart.forEach(item => {
        const subtotal = item.jumlah * item.harga;
        totalItems += item.jumlah; totalPrice += subtotal;
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${item.menu}</td>
          <td>${item.jumlah}</td>
          <td>Rp${item.harga.toLocaleString()}</td>
          <td>Rp${subtotal.toLocaleString()}</td>
        `;
        tbody.appendChild(row);
      });

      document.getElementById("totalItems").textContent = totalItems;
      document.getElementById("totalPrice").textContent = totalPrice.toLocaleString();
      document.getElementById("totalItemsTop").textContent = totalItems;
      document.getElementById("totalPriceTop").textContent = totalPrice.toLocaleString();
    }

    async function checkout() {
      if (cart.length === 0) { alert("Keranjang kosong."); return; }
      let nama = localStorage.getItem("nama") || prompt("Masukkan Nama:");
      let kelas = localStorage.getItem("kelas") || prompt("Masukkan Kelas:");
      localStorage.setItem("nama", nama); localStorage.setItem("kelas", kelas);

      let pesananText = cart.map(i => `${i.menu} x${i.jumlah}`).join(", ");
      let totalHarga = cart.reduce((acc, i) => acc + i.harga * i.jumlah, 0);

      let allOrders = JSON.parse(localStorage.getItem("orders") || "[]");
      allOrders.push({ id: Date.now(), nama, kelas, pesanan: cart, total: totalHarga });
      localStorage.setItem("orders", JSON.stringify(allOrders));

      let popup = document.getElementById("success-popup");
      popup.classList.add("show"); setTimeout(() => popup.classList.remove("show"), 2000);

      cart = []; renderMenu(document.getElementById("searchBox").value); updateSummary();
    }

    // init
    renderMenu();
    updateSummary();

    // search event
    document.getElementById("searchBox").addEventListener("input", (e) => {
      renderMenu(e.target.value);
    });
  </script>
</body>
</html>
