<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kantin Sekolah</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: "Poppins", sans-serif;
      color: white;
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
      background-size: 300% 300%;
      animation: gradientMove 10s ease infinite;
    }
    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-size: 34px;
      text-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    .menu-item {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 15px;
      margin: 15px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.2);
      transition: all 0.3s ease;
    }
    .menu-item:hover {
      transform: scale(1.02);
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }
    .menu-img {
      width: 70px;
      height: 70px;
      border-radius: 12px;
      object-fit: cover;
      margin-right: 15px;
    }

    /* Counter container */
    .counter {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .counter button {
      width: 36px;
      height: 36px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #007bff, #00d4ff);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .counter button:hover {
      background: linear-gradient(135deg, #0056b3, #0099cc);
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }

    .counter span {
      min-width: 20px;
      text-align: center;
      font-size: 16px;
      font-weight: bold;
    }

    #cart-summary {
      margin-top: 30px;
      background: rgba(0, 0, 0, 0.4);
      padding: 20px;
      border-radius: 15px;
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.2);
      animation: fadeIn 1s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    #cart-summary h2 {
      margin-top: 0;
      text-align: center;
      font-size: 24px;
      margin-bottom: 20px;
    }
    #cart-summary table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
    }
    #cart-summary th, #cart-summary td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    .center { text-align: center; }
    .checkout-btn {
      background: linear-gradient(135deg, #28a745, #6fdd8c);
      border: none;
      padding: 12px 25px;
      border-radius: 30px;
      color: white;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    .checkout-btn:hover {
      background: linear-gradient(135deg, #1e7e34, #4cb96b);
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }
  </style>
</head>
<body>
  <h1>üçî Kantin Sekolah</h1>
  <div id="menu"></div>

  <div id="cart-summary">
    <h2>üõí Keranjang</h2>
    <table id="orderTable">
      <thead>
        <tr>
          <th>Menu</th>
          <th>Jumlah</th>
          <th>Harga</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <p>Total Item: <span id="totalItems">0</span></p>
    <p>Total Harga: Rp<span id="totalPrice">0</span></p>
    <div class="center">
      <button class="checkout-btn" onclick="checkout()">Pesan Sekarang</button>
    </div>
  </div>

  <script>
    const menu = [
      { nama:"Bakwan", harga:8000, gambar:"bakwan.jpg" },
      { nama:"Dayaki", harga:10000, gambar:"dayaki.jpg" },
      { nama:"Donat", harga:6000, gambar:"donat.jpg" },
      { nama:"Pop Mie", harga:7000, gambar:"popmie.jpg" },
      { nama:"Roti Beta", harga:5000, gambar:"rotibeta.jpg" }
    ];

    let cart = [];

    function renderMenu() {
      const menuDiv = document.getElementById("menu");
      menuDiv.innerHTML = "";
      menu.forEach((item, index) => {
        const div = document.createElement("div");
        div.className = "menu-item";
        const cartItem = cart.find(c => c.menu === item.nama);
        const jumlah = cartItem ? cartItem.jumlah : 0;
        div.innerHTML = `
          <div style="display:flex; align-items:center;">
            <img src="${item.gambar}" alt="${item.nama}" class="menu-img">
            <span>${item.nama} - Rp${item.harga.toLocaleString()}</span>
          </div>
          <div class="counter">
            <button onclick="updateCart(${index}, -1)">-</button>
            <span>${jumlah}</span>
            <button onclick="updateCart(${index}, 1)">+</button>
          </div>
        `;
        menuDiv.appendChild(div);
      });
    }

    function updateCart(index, delta) {
      const item = menu[index];
      const cartItem = cart.find(c => c.menu === item.nama);

      if (cartItem) {
        cartItem.jumlah += delta;
        if (cartItem.jumlah <= 0) {
          cart = cart.filter(c => c.menu !== item.nama);
        }
      } else if (delta > 0) {
        cart.push({ menu:item.nama, harga:item.harga, jumlah:1 });
      }
      renderMenu();
      updateSummary();
    }

    function updateSummary() {
      const tbody = document.querySelector("#orderTable tbody");
      tbody.innerHTML = "";
      let totalItems = 0;
      let totalPrice = 0;

      cart.forEach(item => {
        const subtotal = item.jumlah * item.harga;
        totalItems += item.jumlah;
        totalPrice += subtotal;

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${item.menu}</td>
          <td>${item.jumlah}</td>
          <td>Rp${item.harga.toLocaleString()}</td>
          <td>Rp${subtotal.toLocaleString()}</td>
        `;
        tbody.appendChild(row);
      });

      document.getElementById("totalItems").textContent = totalItems;
      document.getElementById("totalPrice").textContent = totalPrice.toLocaleString();
    }

    async function checkout() {
      if (cart.length === 0) { alert("Keranjang kosong!"); return; }
      let nama = localStorage.getItem("nama") || prompt("Masukkan Nama:");
      let kelas = localStorage.getItem("kelas") || prompt("Masukkan Kelas:");
      localStorage.setItem("nama", nama);
      localStorage.setItem("kelas", kelas);

      let pesananText = cart.map(i => `${i.menu} x${i.jumlah}`).join(", ");
      let totalHarga = cart.reduce((acc, i) => acc + i.harga * i.jumlah, 0);

      // simpan ke localStorage untuk konfirmasi.html
      let allOrders = JSON.parse(localStorage.getItem("orders") || "[]");
      allOrders.push({
        id: Date.now(),
        nama, kelas,
        pesanan: cart,
        total: totalHarga
      });
      localStorage.setItem("orders", JSON.stringify(allOrders));

      // Kirim ke Discord dengan Embed
      let webhookURL = "https://discord.com/api/webhooks/1419225376974045336/wYucIqsz8O0yIwkEz7wuTJrmsY8edn3BT-lRBc6-9rzlArF9hm1qTFYsaDIj4it9kceU";
      let embed = {
        title: "üì¢ Pesanan Baru!",
        color: 0x00AAFF,
        fields: [
          { name: "üë§ Nama", value: nama, inline: true },
          { name: "üè´ Kelas", value: kelas, inline: true },
          { name: "üçΩ Pesanan", value: pesananText || "-", inline: false },
          { name: "üí∞ Total", value: `Rp${totalHarga.toLocaleString()}`, inline: false }
        ],
        footer: { text: "Kantin Sekolah" },
        timestamp: new Date()
      };

      await fetch(webhookURL, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ embeds: [embed] })
      });

      alert("Pesanan berhasil dikirim!");
      cart = [];
      renderMenu(); updateSummary();
    }

    renderMenu();
    updateSummary();
  </script>
</body>
</html>
